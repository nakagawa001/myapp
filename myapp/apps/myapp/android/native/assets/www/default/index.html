<!DOCTYPE HTML><html>
    <head>
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="UTF-8">
        <title>index</title>
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" name="viewport">
        <link href="worklight/worklight.css" rel="stylesheet">
        <link href="images/favicon.png" rel="shortcut icon">
        <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
        <link href="css/main.css" rel="stylesheet">
        <link href="vendor/jquery.mobile/jquery.mobile-1.4.3.css" rel="stylesheet">
        <script>
		// Define WL namespace.
		var WL = WL ? WL : {};
		/**
		 * WLClient configuration variables.
		 * Values are injected by the deployer that packs the gadget.
		 */
		WL.StaticAppProps = {
   "APP_DISPLAY_NAME": "myapp",
   "APP_ID": "myapp",
   "APP_SERVICES_URL": "\/apps\/services\/",
   "APP_VERSION": "1.0",
   "ENVIRONMENT": "android",
   "LOGIN_DISPLAY_TYPE": "embedded",
   "WORKLIGHT_NATIVE_VERSION": "154549862",
   "WORKLIGHT_PLATFORM_VERSION": "6.1.0.01.20140427-1450",
   "WORKLIGHT_ROOT_URL": "\/apps\/services\/api\/myapp\/android\/"
};</script>
		<script src="worklight/cordova.js"></script>
		<script src="worklight/wljq.js"></script>
		<script src="worklight/worklight.js"></script>
		<script src="worklight/checksum.js"></script>
		<script src="vendor/jquery/jquery-2.0.3.js"></script>
<script src="vendor/jquery.mobile/jquery.mobile-1.4.3.js"></script>
    </head>
    <body style="display: none;">
	<!--application UI goes here-->
        <div data-role="page">
            <div data-role="header">...</div>
            <div class="ui-content" role="main">
                <a class="ui-btn" href="#" id="btnOpen"> Click here to login </a>
			<a class="ui-btn" href="#" id="foo">Get User Info</a>
            </div>
            <div data-role="footer">...</div>
        </div>
        <a href="#" id="logoutText" onclick="myIFrame.location='https://www.google.com/accounts/Logout'; startLogoutPolling();return false;" style="display: none" target="myIFrame">
		Click here to logout </a>
        <iframe id="myIFrame" name="myIFrame" style="display: none"></iframe>
        <div id="uName"></div>
        <img id="imgHolder" src="">
	<script src="js/initOptions.js"></script>
	<script src="js/main.js"></script>
	<script src="js/messages.js"></script>
<script>
	var OAUTHURL = 'https://accounts.google.com/o/oauth2/auth?';
	var VALIDURL = 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=';
	var SCOPE = 'https://www.google.com/m8/feeds';
	var CLIENTID = '350276189015-6os5esfj3o7msccsnvqs7mis2861nsoj.apps.googleusercontent.com';
	var REDIRECT = 'urn:ietf:wg:oauth:2.0:oob'
	var LOGOUT = 'http://accounts.google.com/Logout';
	var TYPE = 'code';
	var _url = OAUTHURL + 'scope=' + SCOPE + '&client_id=' + CLIENTID
			+ '&redirect_uri=' + REDIRECT + '&response_type=' + TYPE;
	var acToken;
	var tokenType;
	var expiresIn;
	var user;
	var loggedIn = false;
	$(function() {
		$("#foo").on('click', function() {
			//var hogeUrl = 'https://www.googleapis.com/oauth2/v2/userinfo' + '?access_token=' + accessToken;
			var hogeUrl = 'https://www.google.com/m8/feeds/contacts/default/full?alt=json' + '&access_token=' + atValue;
			console.log(hogeUrl);
			$.ajax({
				url:hogeUrl,
				dataType:'json'
			})
			.then(function(data) {
				console.log('suc');
				console.log(JSON.stringify(data));
			}, function(data) {
				console.log('fail');
				console.log(JSON.stringify(data));
			})
		});
	})
	function login() {
		document.location = _url;
		$.ajax({
			url : _url,
			dataType : "html"
		})
		.then(function(data) {
			console.log('suc');
			console.log(JSON.stringify(data));
			alert(JSON.stringify(data));
			$('#ins').html('<html><body>HelloWorld</body></html>');
		}, function() {
			console.log('fail');
		})
	}
	function validateToken(token) {
		$.ajax({
			url : VALIDURL + token,
			data : null,
			success : function(responseText) {
				getUserInfo();
				loggedIn = true;
				$('#loginText').hide();
				$('#logoutText').show();
			},
			dataType : "jsonp"
		});
	}
	function getUserInfo() {
		$
				.ajax({
					url : 'https://www.google.com/m8/feeds/contacts/default/full?access_token='
							+ acToken,
					data : null,
					success : function(resp) {
						user = resp;
						console.log(user);
						$('#uName').text('Welcome ' + user.name);
						$('#imgHolder').attr('src', user.picture);
					},
					dataType : "jsonp"
				});
	}
	//credits: http://www.netlobo.com/url_query_string_javascript.html
	function gup(url, name) {
		name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		var regexS = "[\\#&]" + name + "=([^&#]*)";
		var regex = new RegExp(regexS);
		var results = regex.exec(url);
		if (results == null)
			return "";
		else
			return results[1];
	}
	function startLogoutPolling() {
		$('#loginText').show();
		$('#logoutText').hide();
		loggedIn = false;
		$('#uName').text('Welcome ');
		$('#imgHolder').attr('src', 'none.jpg');
	}
</script>
    </body>
</html>
